      - name: Install Chocolatey
        run: |
          # Install Chocolatey package manager if it's not already installed
          Set-ExecutionPolicy Bypass -Scope Process -Force;
          [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.SecurityProtocolType]::Tls12;
          iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))

      - name: Install Twingate via Chocolatey
        run: |
          # Install Twingate using Chocolatey
          choco install twingate -y

      - name: Authenticate and Connect with Twingate
        run: |
          # Twingate requires a valid authentication token to connect
          # Ensure you have set up the Twingate Service Account and the authentication token
          $twingateAuthToken = "${{ secrets.TWINGATE_AUTH_TOKEN }}"

          # Authenticate Twingate and start the service
          & "C:\Program Files\Twingate\twingate.exe" login --authToken $twingateAuthToken

          # Establish the connection
          & "C:\Program Files\Twingate\twingate.exe" start

          # Wait for the connection to be fully established
          Start-Sleep -Seconds 10

          # Verify the Twingate connection (check IP or network route)
          $twingateStatus = & "C:\Program Files\Twingate\twingate.exe" status
          Write-Host "Twingate Status: $twingateStatus"
